<?php
include "php/db.php";

$username = $_SESSION['nickname'];
$title = addslashes($_POST['title']);
$content = addslashes($_POST['content']);
$date = date('Y-m-d');
$tmpfile = $_FILES['b_file']['tmp_name'];
$o_name = $_FILES['b_file']['name'];
$filename = iconv("UTF-8", "EUC-KR", $_FILES['b_file']['name']);
$folder = "upload/".$filename;
move_uploaded_file($tmpfile, $folder);

if($username && $title && $content) {
    $sql = "INSERT INTO board(name, title, content, date, file) VALUES ('".$username."','".$title."','".$content."','".$date."','".$o_name."')";

    $result = mysqli_query($db, $sql);

    if($result) {
        echo "<script>
        alert('글쓰기 완료되었습니다.');
        location.href='community.php';
    </script>";
    } else {
        echo "<script>
        alert('글쓰기 실패!');
        history.back();
    </script>";
    }
    
} else {
    echo "<script>
        alert('알 수 없는 오류가 발생했습니다.');
        history.back();
    </script>";
}
?>
